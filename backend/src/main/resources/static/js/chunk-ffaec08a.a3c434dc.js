(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ffaec08a"],{"04d1":function(t,e,o){var a=o("342f"),i=a.match(/firefox\/(\d+)/i);t.exports=!!i&&+i[1]},"129f":function(t,e){t.exports=Object.is||function(t,e){return t===e?0!==t||1/t===1/e:t!=t&&e!=e}},2814:function(t,e,o){"use strict";o("6e1a")},"3d38":function(t,e,o){"use strict";o.r(e);var a=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{ref:"mainPanel",staticClass:"mainPanel"},[o("div",{ref:"searchPanel",staticClass:"searchPanel"},[o("el-form",{ref:"searchForm",attrs:{inline:!0,size:"small",model:t.searchForm}},[o("el-form-item",[o("el-radio-group",{attrs:{size:"mini"},on:{change:t.search},model:{value:t.approveState,callback:function(e){t.approveState=e},expression:"approveState"}},[o("el-radio-button",{attrs:{label:"0"}},[t._v("全部")]),o("el-radio-button",{attrs:{label:"1"}},[t._v("待审批")]),o("el-radio-button",{attrs:{label:"2"}},[t._v("已通过")]),o("el-radio-button",{attrs:{label:"3"}},[t._v("已拒绝")]),o("el-radio-button",{attrs:{label:"4"}},[t._v("已取消")]),o("el-radio-button",{attrs:{label:"5"}},[t._v("审批中")])],1)],1),o("el-form-item",{attrs:{label:"申领单号：",prop:"id"}},[o("el-input",{attrs:{placeholder:"请输入",clearable:""},model:{value:t.searchForm.id,callback:function(e){t.$set(t.searchForm,"id",e)},expression:"searchForm.id"}})],1),o("el-form-item",[o("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.search}},[t._v("查询")]),o("el-button",{attrs:{size:"mini"},on:{click:t.resetForm}},[t._v("重置")])],1)],1)],1),o("div",{staticClass:"tablePanel",style:{height:t.tableHeight+"px"}},[o("el-table",{staticClass:"tableGrow",staticStyle:{width:"100%"},attrs:{data:t.dataList,height:"100%"}},[o("el-table-column",{attrs:{label:"操作","min-width":"120",fixed:""},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-button",{attrs:{type:"text",disabled:1!=e.row.state},on:{click:function(o){return t.initiatorApply(e.row)}}},[t._v("发起审批")])]}}])}),o("el-table-column",{attrs:{prop:"id",label:"申领单号","show-overflow-tooltip":"","min-width":"240"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-link",{attrs:{type:"primary"},on:{click:function(o){return t.handleDetail(e.row)}}},[t._v(t._s(e.row.id))])]}}])}),o("el-table-column",{attrs:{prop:"warehouse","show-overflow-tooltip":"",label:"申领仓库","min-width":"140"}}),o("el-table-column",{attrs:{prop:"type","show-overflow-tooltip":"",label:"操作类别","min-width":"140"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t.stockType[e.row.type]))]}}])}),o("el-table-column",{attrs:{prop:"count",label:"备件总数","min-width":"140"}}),o("el-table-column",{attrs:{prop:"state","show-overflow-tooltip":"",label:"状态","min-width":"140"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t.stockState[e.row.state]))]}}])}),o("el-table-column",{attrs:{prop:"createTime",label:"创建时间","min-width":"160"}}),o("el-table-column",{attrs:{prop:"remark","show-overflow-tooltip":"",label:"备注","min-width":"200"}})],1)],1),o("div",{staticClass:"pagePanel"},[o("el-pagination",{attrs:{background:"","current-page":t.pageInfo.pageNum,"page-sizes":[10,20,30,40],"page-size":t.pageInfo.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"update:currentPage":function(e){return t.$set(t.pageInfo,"pageNum",e)},"update:current-page":function(e){return t.$set(t.pageInfo,"pageNum",e)},"update:pageSize":function(e){return t.$set(t.pageInfo,"pageSize",e)},"update:page-size":function(e){return t.$set(t.pageInfo,"pageSize",e)},"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),o("el-dialog",{attrs:{title:"查看",width:"60%",visible:t.dialogFormCheck,"modal-append-to-body":!1},on:{"update:visible":function(e){t.dialogFormCheck=e}}},[o("el-table",{ref:"mStock",staticClass:"tableGrow",attrs:{data:t.currentRow.parts,height:"300px"}},[o("el-table-column",{attrs:{prop:"name",label:"备件名称","show-overflow-tooltip":"","min-width":"140"}}),o("el-table-column",{attrs:{prop:"apply",label:t.stockType[t.currentRow.type]+"数量","min-width":"160"}}),o("el-table-column",{attrs:{prop:"classify","show-overflow-tooltip":"",label:"备件类别","min-width":"140"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t.classify[e.row.classify]))]}}])})],1),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){t.dialogFormCheck=!1}}},[t._v("确 定")])],1)],1)],1)},i=[],n=o("b85c"),r=o("2909"),s=o("5530"),l=(o("4e82"),o("99af"),o("ac1f"),o("841c"),o("4de4"),o("caad"),o("2532"),o("a15b"),o("d81d"),o("c740"),o("b0c0"),o("a9e3"),o("d3b7"),o("5319"),o("25f0"),o("2f62")),c=o("0cd6"),u=o.n(c),p=(o("ed08"),{components:{},filters:{},data:function(){return{pageInfo:{pageNum:1,pageSize:10},total:0,dataList:[],tableHeight:0,searchForm:{id:""},stockState:{1:"待审批",2:"已通过",3:"已拒绝",4:"已取消",5:"审批中"},stockType:{1:"申领",2:"入库",3:"出库"},approveState:"0",dialogFormVisible:!1,dialogFormCheck:!1,currentRow:{},allStockListTemp:[]}},computed:Object(s["a"])({},Object(l["b"])(["classify","allStockList","mimeStockList","allStockInList","allStockOutList","applyingList","process_code","userInfo","process_instance_id","corpId"])),created:function(){console.log("AutoConsole: allStockInList",this.allStockInList),console.log("AutoConsole: allStockOutList",this.allStockOutList),console.log("AutoConsole: applyingList",this.applyingList),this.allStockListTemp=[].concat(Object(r["a"])(this.allStockInList),Object(r["a"])(this.allStockOutList),Object(r["a"])(this.applyingList)).sort((function(t,e){return new Date(e.createTime)-new Date(t.createTime)})),this.getList(),this.isExistTemplate()},mounted:function(){var t=this;this.tableHeight=this.$refs.mainPanel.clientHeight-this.$refs.searchPanel.clientHeight-90,window.onresize=function(){return function(){t.tableHeight=t.$refs.mainPanel.clientHeight-t.$refs.searchPanel.clientHeight-90}()}},beforeDestroy:function(){window.onresize=null},methods:{paging:function(t,e,o){if(!t)return[];var a=u.a.drop(t,o*(e-1)),i=u.a.take(a,o);return i},handleSizeChange:function(t){this.pageInfo.pageNum=1,this.getList()},handleCurrentChange:function(t){this.pageInfo.pageNum=t,this.getList()},search:function(){this.pageInfo.pageNum=1,this.getList()},resetForm:function(){this.$refs.searchForm.resetFields(),this.search()},getList:function(){var t=this,e=this.allStockListTemp.filter((function(e){return e.id.includes(t.searchForm.id)}));0!=this.approveState&&(e=e.filter((function(e){return e.state==t.approveState}))),this.dataList=this.paging(e,this.pageInfo.pageNum,this.pageInfo.pageSize),this.total=e.length},handleDetail:function(t){this.currentRow=t,this.dialogFormCheck=!0},initiatorApply:function(t){var e=this;this.currentRow=t,this.$http.post("/biz/createInstance",{title:"备件申领",url:location.origin+"/#/spareParts/approve/detail?stockId="+t.id,originatorUserId:this.userInfo.userId,processCode:this.process_code,formComponentValues:[{name:"是否同意",value:1==t.type?"申领审批":"出入库审批"}]}).then((function(t){t.success&&(e.$store.commit("demo/SET_PROCESSINSTANCEID",t.data.process_instance_id),e.chooseApplyer())}))},chooseApplyer:function(){var t=this;if(this.$dd)try{this.$dd.ready((function(){console.log("DDJSAPI初始化完成"),t.$dd.biz.contact.choose({multiple:!1,users:[],corpId:t.corpId,max:1,onSuccess:function(e){console.log("AutoConsole: chooseApplyer -> data",e),t.$http.post("/biz/createTodoItem",{processInstanceId:t.process_instance_id,activityId:"",tasks:[{userId:e.map((function(t){return t.emplId})).join(","),url:location.origin+"/#/spareParts/approve/detail?stockId="+t.currentRow.id}]}).then((function(e){e.success&&t.updateData()}))},onFail:function(t){console.log(t)}})}))}catch(e){console.log(e)}},updateData:function(){this.$store.commit("demo/UPDATE_STOCKLISTSTATE",{type:this.currentRow.type,state:5,id:this.currentRow.id}),this.allStockListTemp=[].concat(Object(r["a"])(this.allStockInList),Object(r["a"])(this.allStockOutList),Object(r["a"])(this.applyingList)).sort((function(t,e){return new Date(e.createTime)-new Date(t.createTime)})),this.search()},isExistTemplate:function(){var t=this;this.$http.get("/biz/getTemplateCode",{params:{name:"备件申领审批"}}).then((function(e){e.success?t.$store.commit("demo/SET_PROCESSCODE",e.data.process_code):t.createTemplate()}))},createTemplate:function(){var t=this;this.$http.post("/biz/createOrUpdateApprovalTemplate",{name:"备件申领审批",props:[{id:"TextField-J78F0563",label:"是否同意",required:!0}]}).then((function(e){e.success&&t.$store.commit("demo/SET_PROCESSCODE",e.data.process_code)}))},agreeApply:function(t){var e=this;this.$confirm("确认同意该操作?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var o=[];if(1==t.type){var a,i=Object(n["a"])(t.parts);try{var r=function(){var t=a.value,i=e.allStockList.findIndex((function(e){return e.id==t.id})),n=e.mimeStockList.findIndex((function(e){return e.id==t.id}));if(e.allStockList[i].normal<t.apply)o.push(e.allStockList[i].name);else if(e.$store.commit("demo/UPDATE_ALLSTOCKLIST_NORMAL",{id:e.allStockList[i].id,normal:e.allStockList[i].normal-t.apply}),e.$store.commit("demo/UPDATE_ALLSTOCKLIST_MIMESTOCKNUM",{id:e.allStockList[i].id,apply:t.apply}),-1!=n)e.$store.commit("demo/UPDATE_MIMESTOCKLIST_NORMAL",{id:e.mimeStockList[n].id,normal:Number(e.mimeStockList[n].normal)+Number(t.apply)});else{var r=JSON.parse(JSON.stringify(e.allStockList[i]));r["normal"]=t.apply,e.$store.commit("demo/ADD_MIMESTOCKLIST",r)}};for(i.s();!(a=i.n()).done;)r()}catch(f){i.e(f)}finally{i.f()}}else if(2==t.type){var s,l=Object(n["a"])(t.parts);try{var c=function(){var t=s.value,o=e.allStockList.findIndex((function(e){return e.id==t.id}));e.$store.commit("demo/UPDATE_ALLSTOCKLIST_NORMAL",{id:e.allStockList[o].id,normal:Number(e.allStockList[o].normal)+Number(t.apply)})};for(l.s();!(s=l.n()).done;)c()}catch(f){l.e(f)}finally{l.f()}}else{var u,p=Object(n["a"])(t.parts);try{var d=function(){var t=u.value,a=e.allStockList.findIndex((function(e){return e.id==t.id}));e.allStockList[a].normal<t.apply?o.push(e.allStockList[a].name):e.$store.commit("demo/UPDATE_ALLSTOCKLIST_NORMAL",{id:e.allStockList[a].id,normal:e.allStockList[a].normal-t.apply})};for(p.s();!(u=p.n()).done;)d()}catch(f){p.e(f)}finally{p.f()}}e.$store.commit("demo/UPDATE_STOCKLISTSTATE",{id:t.id,type:t.type,state:2}),o.length>0&&e.$message.error(o.toString()+" 库存不足，操作失败！"),e.search()})).catch((function(){e.$message({type:"info",message:"已取消"})}))},refuseApply:function(t){var e=this;this.$confirm("确认拒绝该操作?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.$store.commit("demo/UPDATE_STOCKLISTSTATE",{id:t.id,type:t.type,state:3}),e.search()})).catch((function(){e.$message({type:"info",message:"已取消"})}))},generateUUID:function(){var t=(new Date).getTime();window.performance&&"function"===typeof window.performance.now&&(t+=performance.now());var e="xxxxxxxxxxxxxxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,(function(e){var o=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?o:3&o|8).toString(16)}));return e}}}),d=p,f=(o("2814"),o("2877")),h=Object(f["a"])(d,a,i,!1,null,"5a6248d0",null);e["default"]=h.exports},"4e82":function(t,e,o){"use strict";var a=o("23e7"),i=o("e330"),n=o("59ed"),r=o("7b0b"),s=o("07fa"),l=o("577e"),c=o("d039"),u=o("addbf"),p=o("a640"),d=o("04d1"),f=o("d998"),h=o("2d00"),m=o("512ce"),g=[],v=i(g.sort),S=i(g.push),b=c((function(){g.sort(void 0)})),y=c((function(){g.sort(null)})),w=p("sort"),k=!c((function(){if(h)return h<70;if(!(d&&d>3)){if(f)return!0;if(m)return m<603;var t,e,o,a,i="";for(t=65;t<76;t++){switch(e=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:o=3;break;case 68:case 71:o=4;break;default:o=2}for(a=0;a<47;a++)g.push({k:e+a,v:o})}for(g.sort((function(t,e){return e.v-t.v})),a=0;a<g.length;a++)e=g[a].k.charAt(0),i.charAt(i.length-1)!==e&&(i+=e);return"DGBEFHACIJK"!==i}})),L=b||!y||!w||!k,x=function(t){return function(e,o){return void 0===o?-1:void 0===e?1:void 0!==t?+t(e,o)||0:l(e)>l(o)?1:-1}};a({target:"Array",proto:!0,forced:L},{sort:function(t){void 0!==t&&n(t);var e=r(this);if(k)return void 0===t?v(e):v(e,t);var o,a,i=[],l=s(e);for(a=0;a<l;a++)a in e&&S(i,e[a]);u(i,x(t)),o=i.length,a=0;while(a<o)e[a]=i[a++];while(a<l)delete e[a++];return e}})},"512ce":function(t,e,o){var a=o("342f"),i=a.match(/AppleWebKit\/(\d+)\./);t.exports=!!i&&+i[1]},"6e1a":function(t,e,o){},"841c":function(t,e,o){"use strict";var a=o("c65b"),i=o("d784"),n=o("825a"),r=o("1d80"),s=o("129f"),l=o("577e"),c=o("dc4a"),u=o("14c3");i("search",(function(t,e,o){return[function(e){var o=r(this),i=void 0==e?void 0:c(e,t);return i?a(i,e,o):new RegExp(e)[t](l(o))},function(t){var a=n(this),i=l(t),r=o(e,a,i);if(r.done)return r.value;var c=a.lastIndex;s(c,0)||(a.lastIndex=0);var p=u(a,i);return s(a.lastIndex,c)||(a.lastIndex=c),null===p?-1:p.index}]}))},addbf:function(t,e,o){var a=o("f36a"),i=Math.floor,n=function(t,e){var o=t.length,l=i(o/2);return o<8?r(t,e):s(t,n(a(t,0,l),e),n(a(t,l),e),e)},r=function(t,e){var o,a,i=t.length,n=1;while(n<i){a=n,o=t[n];while(a&&e(t[a-1],o)>0)t[a]=t[--a];a!==n++&&(t[a]=o)}return t},s=function(t,e,o,a){var i=e.length,n=o.length,r=0,s=0;while(r<i||s<n)t[r+s]=r<i&&s<n?a(e[r],o[s])<=0?e[r++]:o[s++]:r<i?e[r++]:o[s++];return t};t.exports=n},d998:function(t,e,o){var a=o("342f");t.exports=/MSIE|Trident/.test(a)}}]);
//# sourceMappingURL=chunk-ffaec08a.a3c434dc.js.map